{% extends 'base.html.twig' %}

{% block body %}
<div class="main-container">
    <div class="filter-menu" id="filterMenuContainer">
        {% include '/home/filter.html.twig' %}
    </div>
    <div class="cars-list content-container">
        <div class="container">
            <div class="header-container">
                <h2>My Car Listings</h2>
                <button id="addCarBtn">Add Car</button>
            </div>
            
            
            {% for car in cars %}
            <div class="car-listing-container">
                <div class="car-image">
                    <img src="{{ asset('images/car_images/' ~ car.image) }}" alt="{{ car.brand ~ ' ' ~ car.model }}">
                </div>
                <div class="car-details">
                    <h2>{{ car.brand ~ ' ' ~ car.model }}</h2>
                    <p class="car-model">{{ car.model }}</p>
                    <div class="paragraphs">
                        <p><span class="mini-title">Color:</span> {{ car.color }}</p>
                        <p><span class="mini-title">Kilometers:</span> {{ car.km }} km</p>
                        <p><span class="mini-title">Price:</span> ${{ car.price }}</p>
                    </div>
                </div>
                <div class="action-buttons">
                    <a href="{{ path('my_cars_delete_car', {'id': car.id}) }}" class="delete-link">Delete</a>
                    {% if car.isAvailable %}
                        <a href="{{ path('my_cars_mark_car_unavailable', {'id': car.id}) }}" class="edit">Mark Unavailable</a>
                    {% else %}
                        <a href="{{ path('my_cars_mark_car_available', {'id': car.id}) }}" class="edit">Mark Available</a>
                    {% endif %}

                    <button id="updateListingButton{{ car.id }}">Update Listing</button>
                    <a href="#"><button id='ConfirmCommandsBtn{{ car.id }}'>Confirm Commands</button></a>
                    
                    
                    
                </div>
                
            </div>
            {% endfor %}
            
        </div>
    </div>
</div>
<div class="overlay" id="overlay"></div>

<script>
    window.addEventListener('scroll', function() {
        var filterMenuContainer = document.getElementById('filterMenuContainer');
        var contentContainer = document.querySelector('.content-container');
        var scrollY = window.scrollY || window.pageYOffset;

        if (scrollY > contentContainer.offsetTop) {
            filterMenuContainer.style.top = (scrollY - contentContainer.offsetTop) + 'px';
        } else {
            filterMenuContainer.style.top = '0';
        }
    });

    // Changed by AgressivePug
    document.addEventListener("DOMContentLoaded", function() {
        {% for car in cars %}
            // Add event listener for "Update Listing" button
            document.getElementById("updateListingButton{{ car.id }}").addEventListener("click", function() {
                document.getElementById("popup{{ car.id }}").style.display = "block";
                document.getElementById("overlay").style.display = "block";
            });

            // Add event listener for "Confirm Commands" button
            document.getElementById("ConfirmCommandsBtn{{ car.id }}").addEventListener("click", function() {
                document.getElementById("commandsPopup{{ car.id }}").style.display = "block";
                document.getElementById("overlay").style.display = "block";
            });
        {% endfor %}

        // Add event listener to close popups and overlay when clicking outside popups
        document.getElementById("overlay").addEventListener("click", function() {
            {% for car in cars %}
                document.getElementById("popup{{ car.id }}").style.display = "none";
                document.getElementById("commandsPopup{{ car.id }}").style.display = "none";
            {% endfor %}
            document.getElementById("addCarPopup").style.display = "none";
            document.getElementById("overlay").style.display = "none";
        });

        document.getElementById("addCarBtn").addEventListener("click", function() {
            document.getElementById("addCarPopup").style.display = "block";
            document.getElementById("overlay").style.display = "block";
        });
    });

    function displayFileNameUpdate(input, id) {
        var fileName = input.files[0].name;
        var fileNameElement = document.getElementById('update-name' + id);
        if (fileName.length > 20) {
            fileName = fileName.substring(0, 20) + "..."; // Truncate if over 20 characters
        }
        fileNameElement.textContent = fileName;
    }
</script>
{% endblock %}



